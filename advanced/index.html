
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Trading framework for Betfair API-NG.">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.4">
    
    
      
        <title>Advanced Usage - flumine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="flumine" class="md-header-nav__button md-logo" aria-label="flumine">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            flumine
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Advanced Usage
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/liampauling/flumine" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    liampauling/flumine
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="flumine" class="md-nav__button md-logo" aria-label="flumine">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    flumine
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/liampauling/flumine" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    liampauling/flumine
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../quickstart/" class="md-nav__link">
      QuickStart
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../markets/" class="md-nav__link">
      Markets
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../execution/" class="md-nav__link">
      Clients / Execution
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../trades/" class="md-nav__link">
      Trades / Orders
    </a>
  </li>

    
      
      
      


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Advanced Usage
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Advanced Usage
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flumine" class="md-nav__link">
    Flumine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-strategy" class="md-nav__link">
    Base Strategy
  </a>
  
    <nav class="md-nav" aria-label="Base Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runner-context" class="md-nav__link">
    Runner Context
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streams" class="md-nav__link">
    Streams
  </a>
  
    <nav class="md-nav" aria-label="Streams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#market-stream" class="md-nav__link">
    Market Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-stream" class="md-nav__link">
    Data Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#historical-stream" class="md-nav__link">
    Historical Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-stream" class="md-nav__link">
    Order Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-event" class="md-nav__link">
    Custom Event
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trading-controls" class="md-nav__link">
    Trading Controls
  </a>
  
    <nav class="md-nav" aria-label="Trading Controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-controls" class="md-nav__link">
    Client Controls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trading-controls_1" class="md-nav__link">
    Trading Controls
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging-controls" class="md-nav__link">
    Logging Controls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background-workers" class="md-nav__link">
    Background Workers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    Config
  </a>
  
    <nav class="md-nav" aria-label="Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulated" class="md-nav__link">
    simulated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance_id" class="md-nav__link">
    instance_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostname" class="md-nav__link">
    hostname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process_id" class="md-nav__link">
    process_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#current_time" class="md-nav__link">
    current_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raise_errors" class="md-nav__link">
    raise_errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../design/" class="md-nav__link">
      Design
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../help/" class="md-nav__link">
      Help
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flumine" class="md-nav__link">
    Flumine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-strategy" class="md-nav__link">
    Base Strategy
  </a>
  
    <nav class="md-nav" aria-label="Base Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runner-context" class="md-nav__link">
    Runner Context
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streams" class="md-nav__link">
    Streams
  </a>
  
    <nav class="md-nav" aria-label="Streams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#market-stream" class="md-nav__link">
    Market Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-stream" class="md-nav__link">
    Data Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#historical-stream" class="md-nav__link">
    Historical Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-stream" class="md-nav__link">
    Order Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-event" class="md-nav__link">
    Custom Event
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trading-controls" class="md-nav__link">
    Trading Controls
  </a>
  
    <nav class="md-nav" aria-label="Trading Controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-controls" class="md-nav__link">
    Client Controls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trading-controls_1" class="md-nav__link">
    Trading Controls
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging-controls" class="md-nav__link">
    Logging Controls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background-workers" class="md-nav__link">
    Background Workers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    Config
  </a>
  
    <nav class="md-nav" aria-label="Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulated" class="md-nav__link">
    simulated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance_id" class="md-nav__link">
    instance_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostname" class="md-nav__link">
    hostname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process_id" class="md-nav__link">
    process_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#current_time" class="md-nav__link">
    current_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raise_errors" class="md-nav__link">
    raise_errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="advanced">Advanced</h1>
<h2 id="flumine">Flumine</h2>
<p>Functions:</p>
<ul>
<li><code>add_worker</code> Adds a <a href="/advanced/#background-workers">worker</a> to the framework</li>
<li><code>add_client_control</code> Adds a <a href="/advanced/#client-controls">client control</a> to the framework</li>
<li><code>add_trading_control</code> Adds a <a href="/advanced/#trading-controls">trading control</a> to the framework</li>
<li><code>add_market_middleware</code> Adds <a href="/markets/#middleware">market middleware</a> to the framework</li>
<li><code>add_logging_control</code> Adds a <a href="/advanced/#logging-controls">logging control</a> to the framework</li>
</ul>
<p>The Flumine class can be adapted by overriding the following functions:</p>
<ul>
<li><code>_process_market_books()</code> called on MarketBook event</li>
<li><code>_process_market_orders()</code> called when market has pending orders</li>
<li><code>_process_order_package()</code> called on new OrderPackage</li>
<li><code>_add_live_market()</code> called when new Market received through streams</li>
<li><code>_process_raw_data()</code> called on RawData event</li>
<li><code>_process_market_catalogues</code> called on MarketCatalogue event</li>
<li><code>_process_current_orders</code> called on currentOrders event</li>
<li><code>_process_custom_event</code> called on CustomEvent event see <a href="/advanced/#custom-event">here</a></li>
<li><code>_process_close_market</code> called on Market closure</li>
<li><code>_process_cleared_orders()</code> called on ClearedOrders event</li>
<li><code>_process_cleared_markets()</code> called on ClearedMarkets event</li>
<li><code>_process_end_flumine()</code> called on Flumine termination</li>
</ul>
<h2 id="base-strategy">Base Strategy</h2>
<h3 id="parameters">Parameters</h3>
<ul>
<li><code>market_filter</code> Streaming market filter required</li>
<li><code>market_data_filter</code> Streaming market data filter required</li>
<li><code>streaming_timeout</code> Streaming timeout, will call snap() on cache every x seconds</li>
<li><code>conflate_ms</code> Streaming conflate</li>
<li><code>stream_class</code> MarketStream or RawDataStream</li>
<li><code>name</code> Strategy name, if None will default to class name</li>
<li><code>context</code> Dictionary object where any extra data can be stored here such as triggers</li>
<li><code>max_selection_exposure</code> Max exposure per selection (including new order), note this does <strong>not</strong> handle reduction in exposure due to laying another runner</li>
<li><code>max_order_exposure</code> Max exposure per order</li>
<li><code>client</code> Strategy client, half implemented when flumine will be migrated to multi clients</li>
<li><code>max_trade_count</code> Max total number of trades per runner</li>
<li><code>max_live_trade_count</code> Max live (with executable orders) trades per runner</li>
</ul>
<h3 id="functions">Functions</h3>
<p>The following functions can be overridden dependant on the strategy:</p>
<p><code>add()</code> Function called when strategy is added to framework</p>
<p><code>start()</code> Function called when framework starts</p>
<p><code>check_market_book()</code> Function called with marketBook, <code>process_market_book</code> is only executed if this returns True</p>
<p><code>process_market_book()</code> Processes market book updates, called on every update that is received</p>
<p><code>process_raw_data()</code> As per <code>process_market_book</code> but handles raw data</p>
<p><code>process_orders()</code> Process list of Order objects for strategy and Market</p>
<p><code>process_closed_market()</code> Process Market after closure</p>
<p><code>finish()</code> Function called when framework ends</p>
<p><code>place_order()</code> Places an order by first validating using <code>validate_order</code></p>
<p><code>cancel_order()</code> Cancel an order</p>
<p><code>update_order()</code> Updates an order</p>
<p><code>replace_order()</code> Replaces an order</p>
<h3 id="runner-context">Runner Context</h3>
<h2 id="streams">Streams</h2>
<h3 id="market-stream">Market Stream</h3>
<p>Flumine handles market streams by taking the parameters provided in the strategies, a strategy will then subscribe to the stream. This means strategies can share streams reducing load or create new if they require different markets or data filter.</p>
<h3 id="data-stream">Data Stream</h3>
<p>Similar to Market Streams but the raw streaming data is passed back, this reduces ram/CPU and allows recording of the data for future playback, see the example marketrecorder.py</p>
<h3 id="historical-stream">Historical Stream</h3>
<p>This is created on a per market basis when backtesting.</p>
<h3 id="order-stream">Order Stream</h3>
<p>Subscribes to all orders per running instance using the <code>config.hostname</code></p>
<h2 id="custom-event">Custom Event</h2>
<h2 id="trading-controls">Trading Controls</h2>
<p>Before placing an order flumine will check the client and trading controls, this allows validation to occur before execution. If an order does not meet any of these validations it is not executed and status is updated to <code>Violation</code>.</p>
<h3 id="client-controls">Client Controls</h3>
<ul>
<li><code>MaxOrderCount</code>: Checks order count is not over betfair transaction limit (5000 per hour) </li>
</ul>
<h3 id="trading-controls_1">Trading Controls</h3>
<ul>
<li><code>OrderValidation</code>: Checks order is valid (size/odds)</li>
<li><code>StrategyExposure</code>: Checks order does not go over <code>strategy.max_order_exposure</code> and <code>strategy.max_selection_exposure</code></li>
</ul>
<h2 id="logging-controls">Logging Controls</h2>
<p>Custom logging is available using the <code>LoggingControl</code> class, the <a href="https://github.com/liampauling/flumine/blob/master/flumine/controls/loggingcontrols.py#L12">base class</a> creates debug logs and can be used as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine.controls.loggingcontrols</span> <span class="kn">import</span> <span class="n">LoggingControl</span>

<span class="n">control</span> <span class="o">=</span> <span class="n">LoggingControl</span><span class="p">()</span>

<span class="n">framework</span><span class="o">.</span><span class="n">add_logging_control</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>More than one control can be added, for example a csv logger and db logger.</p>
</div>
<h2 id="background-workers">Background Workers</h2>
<p>By default flumine adds the following workers:</p>
<ul>
<li><code>keep_alive</code>: runs every 1200s to make sure the client is either logged in or kept alive</li>
<li><code>poll_account_balance</code>: runs every 60s to poll account balance endpoint</li>
<li><code>poll_market_catalogue</code>: runs every 60s to poll listMarketCatalogue endpoint</li>
<li><code>poll_cleared_orders</code>: runs when closed market is added to <code>flumine.cleared_market_queue</code></li>
</ul>
<p>Further workers can be added as per:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine.worker</span> <span class="kn">import</span> <span class="n">BackgroundWorker</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="n">worker</span> <span class="o">=</span> <span class="n">BackgroundWorker</span><span class="p">(</span>
    <span class="n">framework</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">func_args</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;print_a&quot;</span>
<span class="p">)</span>

<span class="n">framework</span><span class="o">.</span><span class="n">add_worker</span><span class="p">(</span>
    <span class="n">worker</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="error-handling">Error Handling</h2>
<p>Flumine will catch all errors that occur in <code>strategy.check_market</code> and <code>strategy.process_market_book</code>, and log either error or critical errors.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can remove this error handling by setting <code>config.raise_errors = True</code></p>
</div>
<h2 id="logging">Logging</h2>
<p>jsonlogger is used to log extra detail, see below for a typical setup:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pythonjsonlogger</span> <span class="kn">import</span> <span class="n">jsonlogger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

<span class="n">custom_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(asctime) %</span><span class="s2">(levelname) %(message)&quot;</span>
<span class="n">log_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">jsonlogger</span><span class="o">.</span><span class="n">JsonFormatter</span><span class="p">(</span><span class="n">custom_format</span><span class="p">)</span>
<span class="n">formatter</span><span class="o">.</span><span class="n">converter</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span>
<span class="n">log_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">log_handler</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</code></pre></div>

<h2 id="config">Config</h2>
<h3 id="simulated">simulated</h3>
<p>Updated to True when backtesting or paper trading</p>
<h3 id="instance_id">instance_id</h3>
<p>Store server id or similar (e.g. AWS ec2 instanceId)</p>
<h3 id="hostname">hostname</h3>
<p>Used as customerStrategyRefs so that only orders created by the running instance is returned.</p>
<h3 id="process_id">process_id</h3>
<p>OS process id of running application.</p>
<h3 id="current_time">current_time</h3>
<p>Used for backtesting</p>
<h3 id="raise_errors">raise_errors</h3>
<p>Raises errors on strategy functions, see <a href="/advanced/#error-handling">Error Handling</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../trades/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Trades / Orders
              </div>
            </div>
          </a>
        
        
          <a href="../design/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Design
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>